import PropTypes from 'prop-types';
import { MapControl, withLeaflet } from 'react-leaflet';
import L from 'leaflet';
import 'react';

function styleInject(css, ref) {
  if ( ref === void 0 ) ref = {};
  var insertAt = ref.insertAt;

  if (!css || typeof document === 'undefined') { return; }

  var head = document.head || document.getElementsByTagName('head')[0];
  var style = document.createElement('style');
  style.type = 'text/css';

  if (insertAt === 'top') {
    if (head.firstChild) {
      head.insertBefore(style, head.firstChild);
    } else {
      head.appendChild(style);
    }
  } else {
    head.appendChild(style);
  }

  if (style.styleSheet) {
    style.styleSheet.cssText = css;
  } else {
    style.appendChild(document.createTextNode(css));
  }
}

var css = "div.layer-list-open-button {\n\tcursor: pointer;\n\twidth: 32px;\n\theight: 32px;\n\tposition: relative;\n    font-family: sans-serif;\n    color: white;\n    text-decoration: none;\n    background: white;\n    border-radius: 4px;\n\tdisplay: block;\n\tfloat: right;\n}\n\ndiv.layer-list-open-button:before {\n\tposition: absolute;\n    top: 50%;\n    left: .75em;\n    width: 1.2em;\n    height: 1.2em;\n    margin-top: -.5em;\n    content: '';\n    background-repeat: no-repeat;\n    background-size: contain;\n    background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHMAAABkCAMAAACCTv/3AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAZQTFRFAAAA5ubmSUUG+gAAAAJ0Uk5T/wDltzBKAAAAPklEQVR42uzYQQ0AAAgDseHfNC4IyVoD912WAACUm3uampqampqamq+aAAD+IVtTU1NTU1NT0z8EAFBsBRgAX+kR+Qam138AAAAASUVORK5CYII=);\n}\n\ndiv.layer-list-open-button.hidden {\n\tdisplay: none;\n}\n\ndiv.layer-list-open-button.visible {\n\tdisplay: block;\n}\n\ndiv.layer-list-close-button {\n\tcursor: pointer;\n\twidth: 32px;\n\theight: 32px;\n\tposition: relative;\n    font-family: sans-serif;\n    color: white;\n    text-decoration: none;\n    background: white;\n    border-radius: 4px;\n\tdisplay: block;\n\tfloat: right;\n}\n\ndiv.layer-list-close-button:before {\n\tposition: absolute;\n    top: 50%;\n    left: .75em;\n    width: 1.2em;\n    height: 1.2em;\n    margin-top: -.5em;\n    content: '';\n    background-repeat: no-repeat;\n    background-size: contain;\n\tbackground-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAxlJREFUeJztmstOVEEQhr9zZgAHeAVXvqUmJoQEJSFBUfAOCCiOCMFLCAEU9YFMWOjGKC5qOhkmZ86luroHTH9JrQj911/dcPpSkEgkEolEIlGfaeA9cAbcGXEuObAE/EJymgotOAV8B877YhnIQgsXkAPrA7mcApOhBCeBrwOCLh4Ttwg5sDEkly9Ax1pwsjdwkaCLZ8QpQgvYqsjlM4ZF6PQGLBN0sYrMTihawOuauZxgVITdmoIuXhKmCG2g2zCXHQvh3w1Fz4FNZLasaCNmmubx00J8VSF8jixViyKM0XwVulgx0FctPRfd3u9rGQP2lNobGP4ptoBtZSI76IowDuwrNdcI8H+ozudnWOwhs1mXceCDUusFAb9EZRuQqtjvGatiAvik1HhKhL1IjiwxTYIfewaHMQEcKMd+RMTdaI4sNU2iBxQX4RpwqBxzJOeRDFlymoQPEcOODnCkHGspnMVqMmTpaRI/Qox3kG2rZozF8BaryZAlqDFwQv1zxmAsxDDXhCV0RjQxH8lTYxYJb34umhslC4QzPxvRhxfz2JufierAgDnszN+OnLsZs/ibvxU9a2Nm0Ju/GTq5kPd3bvzrHr9/g9FcuZuQob9N6o/nXMEiZOgPS0UR68rdhAyZNevP4JUoQijzLqJceGjJkFkKZd7FEy5hEXzuBjQR+y2ylAyZFY2RVfRfiqhXYMPwMb+G7BN87hhXGGERMmQpahJf5+ImrOitv24shzJYhs9V2LDH07z3s0tfhAxZepbmHT5FeGhncTg+5jepd/bweXx54G+xHO3l5xbNDl45UjCNVrBrcq35V+ieyXP0b5H3FXqlaM379gi0kAJqtO956F7grjKBbWwaJJr0BQ2GySXqmUL4DbYtMtoi/LAQb9qh0cXWvEPTpNG1EK7TI+jiLX4tMVW0kNVVJ5djDHsFy7pEXWhbYZrSorpnyaxHsJ8p4NsQwXfEMe9oI6utKBfTLtFBipqld4lr3lHUO3hKwGZpxzTS4PAX2a01aX6ypo2cIv8gfUXBzfczSuODhH7fSCQSiUTif+QfU9w4aogEWMMAAAAASUVORK5CYII=);\n}\n\ndiv.layer-list-close-button.hidden {\n\tdisplay: none;\n}\n\ndiv.layer-list-close-button.visible {\n\tdisplay: block;\n}\n\ndiv.layer-list-container.open {\n\twidth: 25vw;\n\theight: 98vh;\n\tborder-radius: 4px;\n\tbackground: white;\n\ttransition: 0.35s all;\n\toverflow-y: scroll;\n}\n\ndiv.layer-list-container.closed {\n\twidth: 32px;\n\theight: 32px;\n\tbackground: transparent;\n\tmargin-right: 11px;\n\tborder-radius: 4px;\n\ttransition: 0.35s all;\n\tcursor: pointer;\n}\n\ndiv.layer-list-item-container {\n\tanimation: 0.1s fadeIn;\n\tanimation-fill-mode: forwards;\n  \tvisibility: hidden;\n}\n\ndiv.layer-list-item-container.item-0 {\n\tmargin-top: 32px;\n}\n\n/** The 0.1 second delay for visible prevents a slight flicker of content as the layer list opens **/\n@keyframes fadeIn {\n\t99% {\n\t  visibility: hidden;\n\t}\n\t100% {\n\t  visibility: visible;\n\t}\n  }";
styleInject(css);

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) {
  return typeof obj;
} : function (obj) {
  return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
};

var classCallCheck = function (instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
};

var createClass = function () {
  function defineProperties(target, props) {
    for (var i = 0; i < props.length; i++) {
      var descriptor = props[i];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ("value" in descriptor) descriptor.writable = true;
      Object.defineProperty(target, descriptor.key, descriptor);
    }
  }

  return function (Constructor, protoProps, staticProps) {
    if (protoProps) defineProperties(Constructor.prototype, protoProps);
    if (staticProps) defineProperties(Constructor, staticProps);
    return Constructor;
  };
}();

var _extends = Object.assign || function (target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i];

    for (var key in source) {
      if (Object.prototype.hasOwnProperty.call(source, key)) {
        target[key] = source[key];
      }
    }
  }

  return target;
};

var inherits = function (subClass, superClass) {
  if (typeof superClass !== "function" && superClass !== null) {
    throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
  }

  subClass.prototype = Object.create(superClass && superClass.prototype, {
    constructor: {
      value: subClass,
      enumerable: false,
      writable: true,
      configurable: true
    }
  });
  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
};

var possibleConstructorReturn = function (self, call) {
  if (!self) {
    throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
  }

  return call && (typeof call === "object" || typeof call === "function") ? call : self;
};

var equal = require('deep-equal');

var ReactDOM = require('react-dom');

L.Control.LayerListControl = L.Control.extend({
	_layerListContainer: null,
	_isOpen: false,
	_layerlistItems: [],
	_children: [],
	_openButton: null,
	_closeButton: null,
	_openButtonStyle: null,
	_closeButtonStyle: null,
	_layerListStyle: null,
	_position: null,
	_style: null,
	initialize: function initialize(element) {
		this._position = element.position;
		this._children = this.initChildren(element.children);
		this._layerListItems = new Array();
		this._style = element.style;
		this._renderExclude = element.renderExclude;
		this._openButtonStyle = element.openButtonStyle;
		this._closeButtonStyle = element.closeButtonStyle;
		this._onOpen = element.onOpen;
		this._onClose = element.onClose;
		this._startOpen = element.startOpen;
		this._debounceActive = false;
	},
	initChildren: function initChildren(children) {
		var newChildren = [];
		for (var i = 0; i < children.length; i++) {
			if (children[i]) {
				if (children[i]._tail || children[i]._root || children[i].length) {
					children[i].map(function (element) {
						if (element) {
							newChildren.push(element);
						}
					});
				} else {
					newChildren.push(children[i]);
				}
			}
		}
		return newChildren;
	},

	onAdd: function onAdd(map) {
		var _this = this;

		this.options.position = this._position;
		this._layerListContainer = L.DomUtil.create('div', 'layer-list-container closed');
		this._openButton = L.DomUtil.create('div', 'layer-list-open-button visible', this._layerListContainer);
		this._closeButton = L.DomUtil.create('div', 'layer-list-close-button hidden', this._layerListContainer);
		this._map = map;

		if (this._openButtonStyle) {
			Object.keys(this._openButtonStyle).forEach(function (key) {
				_this._openButton.style[key] = _this._openButtonStyle[key];
			});
		}

		if (this._closeButtonStyle) {
			Object.keys(this._closeButtonStyle).forEach(function (key) {
				_this._closeButton.style[key] = _this._closeButtonStyle[key];
			});
		}
		if (this._startOpen) this.open(map);
		L.DomEvent.on(this._openButton, 'click', function () {
			_this.open(map);
		});

		L.DomEvent.on(this._closeButton, 'click', function () {
			_this.close(map);
		});

		L.DomEvent.on(this._map, 'click', function () {
			if (_this._isOpen) {
				_this.close(map);
			}
		});

		L.DomEvent.disableClickPropagation(this._openButton);
		L.DomEvent.disableClickPropagation(this._closeButton);
		L.DomEvent.disableClickPropagation(this._layerListContainer);
		L.DomEvent.disableScrollPropagation(this._layerListContainer);
		return this._layerListContainer;
	},
	onRemove: function onRemove(map) {
		// Do nothing
	},
	open: function open(map) {
		var _this2 = this;

		if (!this._isOpen) {
			if (this._onOpen) this._onOpen();
			L.DomUtil.removeClass(this._openButton, 'visible');
			L.DomUtil.addClass(this._openButton, 'hidden');

			L.DomUtil.removeClass(this._closeButton, 'hidden');
			L.DomUtil.addClass(this._closeButton, 'visible');

			L.DomUtil.removeClass(this._layerListContainer, 'closed');
			L.DomUtil.addClass(this._layerListContainer, 'open');

			if (this._style) {
				Object.keys(this._style).forEach(function (key) {
					_this2._layerListContainer.style[key] = _this2._style[key];
				});
			}

			this._showLayerlistElements(map);
			this._isOpen = true;
		}
	},
	close: function close(map) {
		var _this3 = this;

		L.DomUtil.removeClass(this._openButton, 'hidden');
		L.DomUtil.addClass(this._openButton, 'visible');

		L.DomUtil.removeClass(this._closeButton, 'visible');
		L.DomUtil.addClass(this._closeButton, 'hidden');

		L.DomUtil.removeClass(this._layerListContainer, 'open');
		L.DomUtil.addClass(this._layerListContainer, 'closed');
		this._removeLayerlistElements(map);

		if (this._onClose) this._onClose();
		if (this._style) {
			Object.keys(this._style).forEach(function (key) {
				_this3._layerListContainer.style[key] = null;
			});
		}

		this._isOpen = false;
	},
	_showLayerlistElements: function _showLayerlistElements(map) {
		for (var index = 0; index < this._children.length; index++) {
			var item = this._children[index];
			var container = L.DomUtil.create('div', 'layer-list-item-container item-' + index, this._layerListContainer);
			this._layerListItems.push(container);
			var el = ReactDOM.createPortal(item, container);
			ReactDOM.render(el, container);
		}
	},
	_removeLayerlistElements: function _removeLayerlistElements(map) {
		for (var index = 0; index < this._layerListItems.length; index++) {
			var item = this._layerListItems[index];
			L.DomUtil.remove(item);
		}
		this._layerListItems = [];
	},
	_updateLayerlistElements: function _updateLayerlistElements(element) {
		if (this._isOpen && !this._debounceActive) {
			var map = this._map;
			this._debounceActive = true;
			var newChildren = this.initChildren(element.children);

			var keepLayerListItems = [];
			var farCan = false;
			var numberOfItems = newChildren.length > this._children.length ? newChildren.length : this._children.length;
			for (var index = 0; index < numberOfItems; index++) {
				if (!farCan && newChildren[index] && this._children[index] && this._compareNodes(this._children[index], newChildren[index])) {
					keepLayerListItems.push(this._layerListItems[index]);
				} else {
					farCan = true;
					var item = newChildren[index];
					var layerItem = this._layerListItems[index];
					if (layerItem) {
						L.DomUtil.remove(layerItem);
					}
					if (newChildren[index]) {
						var container = L.DomUtil.create('div', 'layer-list-item-container item-' + index, this._layerListContainer);
						keepLayerListItems.push(container);
						var el = ReactDOM.createPortal(item, container);
						ReactDOM.render(el, container);
					}
				}
			}
			this._layerListItems = keepLayerListItems;
			this._children = newChildren;
			this._debounceActive = false;
		} else {
			this._children = this.initChildren(element.children);
		}
	},
	_compareNodes: function _compareNodes(node1, node2) {
		return this.stringifyNode(node1, this._renderExclude) === this.stringifyNode(node2, this._renderExclude);
	}, stringifyNode: function stringifyNode(node, exclude) {
		var cache = [];
		var stringify = JSON.stringify(node, function (key, value) {
			if ((typeof value === 'undefined' ? 'undefined' : _typeof(value)) === 'object' && value !== null) {
				if (cache.indexOf(value) !== -1) {
					return;
				}
				cache.push(value);
			}
			if (key === "_owner") return undefined;
			if (exclude && exclude.length) {
				for (var i = 0; i < exclude.length; i++) {
					if (key === exclude[i]) return undefined;
				}
			}
			return value;
		});
		cache = null;
		return stringify;
	}
});

L.control.layerListControl = function (opts) {
	return new L.Control.LayerListControl(_extends({}, opts));
};

var ReactLeafletLayerList = function (_MapControl) {
	inherits(ReactLeafletLayerList, _MapControl);

	function ReactLeafletLayerList(props) {
		classCallCheck(this, ReactLeafletLayerList);
		return possibleConstructorReturn(this, (ReactLeafletLayerList.__proto__ || Object.getPrototypeOf(ReactLeafletLayerList)).call(this, props));
	}

	createClass(ReactLeafletLayerList, [{
		key: 'componentWillReceiveProps',
		value: function componentWillReceiveProps() {
			this._layerList._updateLayerlistElements(this.props);
		}
	}, {
		key: 'createLeafletElement',
		value: function createLeafletElement(props) {
			this._layerList = L.control.layerListControl(_extends({
				position: props.position || 'topright',
				style: props.style,
				onOpen: props.onOpen,
				onClose: props.onClose,
				startOpen: props.startOpen,
				renderExclude: props.renderExclude,
				openButtonStyle: props.openButtonStyle
			}, props));
			return this._layerList;
		}
	}]);
	return ReactLeafletLayerList;
}(MapControl);

var reactLeafletLayerlist = withLeaflet(ReactLeafletLayerList);

ReactLeafletLayerList.propTypes = {
	position: PropTypes.oneOf(['topright', 'topleft', 'bottomright', 'bottomleft']),
	style: PropTypes.objectOf(PropTypes.oneOfType([PropTypes.string, PropTypes.number])),
	openButtonStyle: PropTypes.objectOf(PropTypes.oneOfType([PropTypes.string, PropTypes.number])),
	closeButtonStyle: PropTypes.objectOf(PropTypes.oneOfType([PropTypes.string, PropTypes.number])),
	onOpen: function onOpen() {
		return null;
	},
	onClose: function onClose() {
		return null;
	},
	renderExclude: [],
	open: true,
	startOpen: false
};

var LayerListItem = function LayerListItem(props) {
  return props.children;
};

export { reactLeafletLayerlist as ReactLeafletLayerList, LayerListItem };
//# sourceMappingURL=index.es.js.map
